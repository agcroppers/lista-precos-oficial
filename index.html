<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lista de PreÃ§os Oficiais</title>
  <style>
    :root{
      --bgA:#f7f8fb;
      --bgB:#eef1f6;
      --ink:#0b0d12;
      --muted:#5c6674;
      --line:rgba(0,0,0,.10);
      --card:rgba(255,255,255,.72);
      --shadow:0 18px 28px rgba(0,0,0,.14);
      --shadow2:0 10px 18px rgba(0,0,0,.10);
      --radiusXL:28px;
      --radiusLG:20px;
      --headGrad: linear-gradient(#d7dee7, #c8d0da);
      --accent:#2e8b57;
      --accentDeep:#1f5a39;

      /* =========================================
         ðŸŽ¨ CORES DOS GRUPOS (Esquerda - Produtos)
         ========================================= */
      --grp-green-bg: rgba(46, 139, 87, 0.12); 
      --grp-green-txt: #14532d; 
      
      --grp-orange-bg: rgba(234, 88, 12, 0.09);
      --grp-orange-txt: #9a3412;

      --grp-blue-bg: rgba(43, 116, 199, 0.09);
      --grp-blue-txt: #1e3a8a;

      --grp-gray-bg: rgba(55, 65, 81, 0.06);
      --grp-gray-txt: #374151;

      /* --- NOVO: LINHA BUDGET (Roxo/Indigo para destaque) --- */
      --grp-budget-bg: rgba(99, 102, 241, 0.14);
      --grp-budget-txt: #4338ca;

      /* =========================================
         ðŸŽ¨ CORES DAS COLUNAS DE PREÃ‡O (Direita)
         ========================================= */
      /* Azul Claro (Over) */
      --col-over-bg: rgba(43, 116, 199, 0.04); 
      --col-over-txt: #2b74c7;
      
      /* Verde Claro (Base) */
      --col-base-bg: rgba(46, 139, 87, 0.06);
      --col-base-txt: #1f5a39;
      
      /* Laranja Claro (Reduzido) */
      --col-red-bg:  rgba(234, 88, 12, 0.04);
      --col-red-txt: #c2410c;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1200px 500px at 50% 10%, #ffffff 0%, rgba(255,255,255,0) 55%),
        linear-gradient(135deg, var(--bgA), var(--bgB));
      min-height:100vh;
      display:flex;
      justify-content:center;
      padding:28px 18px 34px;
    }

    .app{ width:min(1180px, 100%); }

    /* ===== Login (clean) ===== */
    .authWrap{
      min-height: calc(100vh - 56px);
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 8px 0 24px;
    }

    .authCard{
      width: min(520px, 100%);
      border-radius: 26px;
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(0,0,0,.06);
      box-shadow: 0 20px 45px rgba(0,0,0,.12);
      overflow:hidden;
    }

    .authBody{
      padding: 28px 26px 20px;
    }

    .authLogo{
      display:flex;
      justify-content:center;
      margin-bottom: 10px;
    }

    .authLogo img{
      height: 42px;
      width: auto;
      display:block;
    }

    .authTitle{
      margin:0;
      font-size: 28px;
      font-weight: 750;
      letter-spacing: .2px;
      color: #1f5a39;
      text-align:center;
    }

    .authSub{
      margin: 6px 0 18px;
      color: #6b7280;
      font-size: 13px;
      text-align:center;
      line-height: 1.35;
    }

    .authGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin-top: 6px;
    }

    .authField{
      position:relative;
    }

    .authField input{
      width:100%;
      padding: 12px 12px 12px 42px;
      border-radius: 12px;
      border: 1px solid rgba(31, 90, 57, .22);
      outline:none;
      background: #ffffff;
      font-size: 14px;
      transition: box-shadow .15s, border-color .15s;
    }

    .authField input:focus{
      border-color: rgba(31, 90, 57, .45);
      box-shadow: 0 0 0 4px rgba(46, 139, 87, .12);
    }

    .authField svg{
      position:absolute;
      left: 12px;
      top:50%;
      transform: translateY(-50%);
      width: 18px; height: 18px;
      opacity: .55;
      color: #4b5563;
      pointer-events:none;
    }

    .authActions{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin-top: 12px;
    }

    .authBtn{
      appearance:none;
      border:0;
      cursor:pointer;
      border-radius: 12px;
      padding: 12px 14px;
      font-weight: 750;
      background: #1f5a39;
      color:white;
      box-shadow: 0 14px 22px rgba(31, 90, 57, .24);
      transition: filter .15s, transform .08s;
    }

    .authBtn:hover{ filter: brightness(1.04); }
    .authBtn:active{ transform: translateY(1px); }
    .authBtn:disabled{ opacity:.7; cursor:not-allowed; }

    .authLinks{
      display:flex;
      justify-content:center;
      gap:14px;
      margin-top: 8px;
      font-size: 12px;
    }

    .authLinks a{
      color: #2b74c7;
      text-decoration:none;
    }
    .authLinks a:hover{ text-decoration:underline; }

    .authNote{
      margin-top: 12px;
      font-size: 11px;
      color: #6b7280;
      text-align:center;
    }

    .authError{
      margin-top: 12px;
      background: rgba(220, 38, 38, .08);
      border: 1px solid rgba(220, 38, 38, .20);
      color: #991b1b;
      border-radius: 12px;
      padding: 10px 12px;
      font-size: 12px;
      display:none;
    }

    @media (max-width: 480px){
      .authBody{ padding: 24px 18px 18px; }
      .authTitle{ font-size: 26px; }
      .authLogo img{ height: 38px; }
    }

    /* Top bar */
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      margin-bottom:14px;
    }

    .titleWrap{ display:flex; flex-direction:column; gap:3px; }
    h1{
      margin:0;
      font-weight:600;
      letter-spacing:.2px;
      font-size:clamp(22px, 3.2vw, 34px);
    }
    .subtitle{ color:var(--muted); font-size:13px; }

    .controls{
      display:flex;
      align-items:center;
      justify-content:flex-end;
      gap:10px;
      flex-wrap:wrap;
    }

    .segmented{
      display:inline-flex;
      background: rgba(255,255,255,.62);
      border:1px solid rgba(0,0,0,.10);
      border-radius:999px;
      padding:4px;
      box-shadow: var(--shadow2);
      backdrop-filter: blur(8px);
    }

    .segmented button{
      appearance:none;
      border:0;
      background:transparent;
      padding:8px 12px;
      border-radius:999px;
      cursor:pointer;
      font-size:13px;
      color:#222a33;
      display:flex;
      gap:8px;
      align-items:center;
      white-space:nowrap;
    }

    .segmented button[aria-pressed="true"]{
      background: #ffffff;
      box-shadow: 0 10px 18px rgba(0,0,0,.10);
      border:1px solid rgba(0,0,0,.08);
    }

    .pillDot{
      width:9px; height:9px;
      border-radius:999px;
      background: var(--accent);
      box-shadow: 0 0 0 3px rgba(46,139,87,.12);
    }

    .search{
      position:relative;
      min-width: min(320px, 100%);
      flex: 0 1 420px;
    }

    .search input{
      width:100%;
      padding:11px 12px 11px 38px;
      border-radius:999px;
      border:1px solid rgba(0,0,0,.10);
      outline:none;
      background: rgba(255,255,255,.75);
      box-shadow: var(--shadow2);
      backdrop-filter: blur(8px);
      font-size:14px;
    }

    .search svg{
      position:absolute;
      left:12px;
      top:50%;
      transform:translateY(-50%);
      width:16px; height:16px;
      opacity:.55;
    }

    /* Shell */
    .shell{
      background: var(--card);
      border:1px solid rgba(255,255,255,.55);
      border-radius: var(--radiusXL);
      box-shadow: var(--shadow);
      padding:16px;
      backdrop-filter: blur(8px);
    }

    .metaRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:12px;
      padding:2px 2px 0;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.72);
      color:#24303c;
      font-size:12px;
    }

    .rightMeta{ display:flex; align-items:center; gap:8px; flex-wrap:wrap; }

    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.72);
      font-size:12px;
      color:#24303c;
    }

    .chip select{
      border:0;
      background:transparent;
      font:inherit;
      outline:none;
      cursor:pointer;
      color:#24303c;
    }

    .chipBtn{
      cursor:pointer;
      user-select:none;
    }

    /* Table Structure */
    .tableWrap{
      border-radius: var(--radiusLG);
      overflow:hidden;
      border:1px solid rgba(0,0,0,.12);
      background: #ffffff;
      box-shadow: 0 14px 22px rgba(0,0,0,.10);
    }

    table{ width:100%; border-collapse:separate; border-spacing:0; font-size:14px; }

    thead th{
      position:sticky;
      top:0;
      z-index:2;
      background: #eef1f5;
      color:#3d4652;
      text-transform:uppercase;
      font-size:11px;
      font-weight:700;
      letter-spacing:.6px;
      padding:14px 12px;
      border-bottom:1px solid rgba(0,0,0,.10);
      white-space:nowrap;
    }

    tbody td{
      padding:12px 12px;
      border-bottom:1px solid rgba(0,0,0,.06);
      vertical-align:middle;
      transition: background .2s;
    }

    tbody tr:last-child td { border-bottom: none; }
    tbody tr:hover td{ filter: brightness(0.98); }

    /* ========================================================= */
    /* ðŸŽ¨ ESTILIZAÃ‡ÃƒO: CLASSES DE PRODUTO (1Âª Coluna)            */
    /* ========================================================= */
    
    td.type-green  { background: var(--grp-green-bg) !important; color: var(--grp-green-txt) !important; }
    td.type-orange { background: var(--grp-orange-bg) !important; color: var(--grp-orange-txt) !important; }
    td.type-blue   { background: var(--grp-blue-bg) !important; color: var(--grp-blue-txt) !important; }
    td.type-gray   { background: var(--grp-gray-bg) !important; color: var(--grp-gray-txt) !important; }
    
    /* NOVA CLASSE BUDGET */
    td.type-budget { background: var(--grp-budget-bg) !important; color: var(--grp-budget-txt) !important; }

    /* TAG MINIMALISTA */
    .tag-budget {
        display: inline-block;
        font-size: 10px;
        line-height: 1;
        padding: 4px 6px;
        border-radius: 6px;
        background: rgba(99, 102, 241, 0.15); /* Fundo sutil */
        color: #4338ca;
        margin-right: 8px;
        font-weight: 800;
        letter-spacing: 0.5px;
        text-transform: uppercase;
        vertical-align: middle;
        border: 1px solid rgba(99, 102, 241, 0.25);
        transform: translateY(-1px);
    }

    /* ========================================================= */
    /* ðŸŽ¨ ESTILIZAÃ‡ÃƒO: COLUNAS DE PREÃ‡O (Direita)                */
    /* ========================================================= */

    /* Over (Azul) */
    table th:nth-child(6), table td:nth-child(6) {
        background-color: var(--col-over-bg);
        color: var(--col-over-txt);
        border-left: 1px solid rgba(255,255,255,0.8);
    }

    /* Base (Verde) - Destaque sutil */
    table th:nth-child(7), table td:nth-child(7) {
        background-color: var(--col-base-bg);
        color: var(--col-base-txt);
        border-left: 1px solid rgba(255,255,255,0.8);
        font-weight: 600;
    }

    /* Reduzido (Laranja) */
    table th:nth-child(8), table td:nth-child(8) {
        background-color: var(--col-red-bg);
        color: var(--col-red-txt);
        border-left: 1px solid rgba(255,255,255,0.8);
    }


    .col-item{ width: 40%; }
    .mono{ font-variant-numeric: tabular-nums; }
    .price{ font-weight:600; white-space:nowrap; }
    .muted{ color:var(--muted); }

    /* Mobile cards */
    .cards{ display:none; }
    .cardGrid{ display:grid; grid-template-columns: 1fr; gap:10px; }

    .pCard{
      background: rgba(255,255,255,.72);
      border:1px solid rgba(0,0,0,.10);
      border-radius: 18px;
      box-shadow: var(--shadow2);
      padding:12px;
      position: relative;
      overflow: hidden;
    }

    /* Pequena barra colorida no card mobile para indicar o tipo */
    .pCard::before {
      content: '';
      position: absolute;
      left: 0; top: 0; bottom: 0;
      width: 5px;
    }
    .pCard.card-green::before { background: var(--grp-green-txt); }
    .pCard.card-orange::before { background: var(--grp-orange-txt); }
    .pCard.card-blue::before { background: var(--grp-blue-txt); }
    .pCard.card-gray::before { background: var(--grp-gray-txt); }
    .pCard.card-budget::before { background: var(--grp-budget-txt); }


    .pHead{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:flex-start;
      margin-bottom:10px;
    }

    .pTitle{ font-weight:650; letter-spacing:.1px; line-height:1.15; font-size:14px; }
    .pMeta{ color:var(--muted); font-size:12px; margin-top:6px; }

    .pPrices{
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap:8px;
      margin-top:10px;
    }

    .pBox{
      padding:10px 8px;
      border-radius:14px;
      border:1px solid rgba(0,0,0,.10);
      background: linear-gradient(#f7f8fa, #eef1f4);
      text-align:center;
    }

    /* Cores tambÃ©m nos cards mobile (PreÃ§o) */
    .pBox.bx-over { background: var(--col-over-bg); color: var(--col-over-txt); border-color: rgba(43, 116, 199, 0.2); }
    .pBox.bx-base { background: var(--col-base-bg); color: var(--col-base-txt); border-color: rgba(46, 139, 87, 0.2); font-weight:700; }
    .pBox.bx-red  { background: var(--col-red-bg);  color: var(--col-red-txt);  border-color: rgba(234, 88, 12, 0.2); }

    .pLabel{ font-size:11px; opacity:0.8; letter-spacing:.2px; margin-bottom:4px; text-transform:uppercase; font-size:10px;}
    .pVal{ margin-top:6px; font-size:14px; font-weight:700; }

    /* Specials */
    .specials{
      margin-top:12px;
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:10px;
    }

    .special{
      background: rgba(255,255,255,.72);
      border:1px solid rgba(0,0,0,.10);
      border-radius: 18px;
      box-shadow: var(--shadow2);
      padding:12px;
      display:flex;
      justify-content:space-between;
      gap:12px;
      align-items:flex-start;
    }

    .special .name{ font-weight:750; letter-spacing:.2px; }
    .special .desc{ color:var(--muted); font-size:12px; margin-top:4px; }
    .special .p{ font-weight:800; white-space:nowrap; }

    /* Chooser */
    .chooser{ min-height: calc(100vh - 80px); display:flex; align-items:center; justify-content:center; }

    .chooserCard{
      width:min(980px, 100%);
      padding:18px;
      border-radius: var(--radiusXL);
      background: rgba(255,255,255,.70);
      border:1px solid rgba(255,255,255,.55);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }

    .chooserTop{ display:flex; flex-direction:column; gap:8px; margin-bottom:14px; padding:6px 6px 0; }
    .chooserTop h2{ margin:0; font-size:clamp(20px, 3.2vw, 30px); font-weight:650; letter-spacing:.2px; }
    .chooserTop p{ margin:0; color:var(--muted); font-size:14px; }

    .chooserGrid{ display:grid; grid-template-columns: 1fr 1fr; gap:14px; }

    .chooseBtn{
      border:1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.78);
      border-radius: 22px;
      padding:16px;
      cursor:pointer;
      text-align:left;
      box-shadow: var(--shadow2);
      transition: transform .12s ease, box-shadow .12s ease;
    }

    .chooseBtn:hover{ transform: translateY(-2px); box-shadow: 0 16px 24px rgba(0,0,0,.12); }
    .chooseBtn:active{ transform: translateY(0); }

    .chooseTitle{ display:flex; align-items:center; gap:10px; font-size:16px; font-weight:750; }
    .chooseDesc{ margin-top:8px; color:var(--muted); font-size:13px; line-height:1.35; }

    .bigIcon{ width:38px; height:38px; border-radius: 14px; display:grid; place-items:center; box-shadow: inset 0 1px 0 rgba(255,255,255,.7); }
    .bigIcon svg{ width:18px; height:18px; }

    .iGreen{ background: radial-gradient(circle at 30% 30%, #98f0b1, #2e8b57); }
    .iBlue{ background: radial-gradient(circle at 30% 30%, #7fc1ff, #2b74c7); }

    /* Responsive */
    @media (max-width: 980px){
      .topbar{ align-items:flex-start; flex-direction:column; }
      .controls{ width:100%; justify-content:space-between; }
      .search{ flex: 1 1 420px; width:100%; }
    }

    @media (max-width: 820px){ .chooserGrid{ grid-template-columns: 1fr; } }

    @media (max-width: 760px){
      .tableWrap{ display:none; }
      .cards{ display:block; }
      .specials{ grid-template-columns: 1fr; }
    }

    @media (max-width: 520px){
      .authBody{ padding:18px 16px 16px; }
    }

    @media (max-width: 420px){
      body{ padding:22px 12px 28px; }
      .shell{ padding:14px; }
      .chooseBtn{ padding:14px; }
      .pPrices{ grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <main class="app" id="app"></main>

  <script>
    window.DATA_CONSUMIDOR=[{item:'SORGO ADV1151 IG SC',kg_ha:'-',kg_sc:'-',kg_bag:'-',preco_over:'',preco_base:'740',preco_reduzido:''},{item:'AG MIX CORINGAÂ® â€” MIX',kg_ha:'30',kg_sc:25,kg_bag:'900',preco_over:'9,20',preco_base:'7,80',preco_reduzido:'6,50'},{item:'AG MIX NEMATOIDEÂ® â€” MIX',kg_ha:'20',kg_sc:25,kg_bag:'900',preco_over:'13,20',preco_base:'11,20',preco_reduzido:'9,35'},{item:'AG MIX CANAÂ® â€” MIX',kg_ha:'30',kg_sc:20,kg_bag:'800',preco_over:'12,00',preco_base:'10,20',preco_reduzido:'8,50'},{item:'AG MIX CAFÃ‰Â® â€” MIX',kg_ha:'30',kg_sc:25,kg_bag:'900',preco_over:'10,50',preco_base:'8,90',preco_reduzido:'7,70'},{item:'AG MIX INVERNOÂ® â€” MIX',kg_ha:'50',kg_sc:20,kg_bag:'800',preco_over:'7,80',preco_base:'6,60',preco_reduzido:'5,20'},{item:'AG MIX PASTEJOÂ® â€” MIX',kg_ha:'25',kg_sc:25,kg_bag:'900',preco_over:'8,95',preco_base:'7,60',preco_reduzido:'6,20'},{item:'AG MIX PRECOCEÂ® â€” MIX',kg_ha:'25',kg_sc:25,kg_bag:'900',preco_over:'7,90',preco_base:'6,70',preco_reduzido:'5,50'},{item:'AG MIX PALHADAÂ® â€” MIX',kg_ha:'25',kg_sc:25,kg_bag:'900',preco_over:'11,80',preco_base:'10,00',preco_reduzido:'8,50'},{item:'AG MIX PACK 01 â€” MIX',kg_ha:'25',kg_sc:20,kg_bag:'900',preco_over:'5,45',preco_base:'4,90',preco_reduzido:'4,50'},{item:'AG MIX PACK 02 â€” MIX',kg_ha:'15',kg_sc:25,kg_bag:'1.000',preco_over:'10,10',preco_base:'8,55',preco_reduzido:'7,30'},{item:'AG MIX PACK 03 â€” MIX',kg_ha:'15',kg_sc:25,kg_bag:'1.000',preco_over:'9,90',preco_base:'8,40',preco_reduzido:'7,00'},
    {item:'LINHA BUDGET - AG MIX 01',kg_ha:'10',kg_sc:20,kg_bag:'700',preco_over:'11,55',preco_base:'9,80',preco_reduzido:'8,20'},{item:'LINHA BUDGET - AG MIX 02',kg_ha:'10',kg_sc:20,kg_bag:'700',preco_over:'8,85',preco_base:'7,50',preco_reduzido:'6,55'},{item:'LINHA BUDGET - AG MIX 03',kg_ha:'20',kg_sc:25,kg_bag:'800',preco_over:'9,55',preco_base:'8,10',preco_reduzido:'6,35'},{item:'LINHA BUDGET - AG MIX 04',kg_ha:'16',kg_sc:25,kg_bag:'800',preco_over:'8,75',preco_base:'7,40',preco_reduzido:'6,00'},{item:'LINHA BUDGET - AG MIX 05',kg_ha:'20',kg_sc:20,kg_bag:'800',preco_over:'7,30',preco_base:'6,20',preco_reduzido:'5,50'},{item:'LINHA BUDGET - AG MIX 06',kg_ha:'21',kg_sc:25,kg_bag:'1.000',preco_over:'6,50',preco_base:'5,50',preco_reduzido:'4,70'},{item:'LINHA BUDGET - AG MIX 07',kg_ha:'13',kg_sc:25,kg_bag:'1.000',preco_over:'6,00',preco_base:'5,10',preco_reduzido:'4,20'},{item:'LINHA BUDGET - AG MIX 08',kg_ha:'15',kg_sc:25,kg_bag:'1.000',preco_over:'9,45',preco_base:'8,00',preco_reduzido:'6,70'},{item:'LINHA BUDGET - AG MIX 09',kg_ha:'15',kg_sc:25,kg_bag:'1.000',preco_over:'11,10',preco_base:'9,40',preco_reduzido:'7,85'},{item:'LINHA BUDGET - AG MIX 10',kg_ha:'27',kg_sc:20,kg_bag:'700',preco_over:'5,00',preco_base:'4,50',preco_reduzido:'4,05'},{item:'LINHA BUDGET - AG MIX 11',kg_ha:'32',kg_sc:20,kg_bag:'700',preco_over:'5,45',preco_base:'4,60',preco_reduzido:'4,00'},{item:'LINHA BUDGET - AG MIX 12',kg_ha:'30',kg_sc:15,kg_bag:'600',preco_over:'6,15',preco_base:'5,20',preco_reduzido:'4,50'},
    {item:'Crotalaria ochroleuca â€” EspÃ©cie',kg_ha:'15',kg_sc:25,kg_bag:'1.000',preco_over:'8,50',preco_base:'7,90',preco_reduzido:'7,20'},{item:'Crotalaria spectabilis â€” EspÃ©cie',kg_ha:'20',kg_sc:25,kg_bag:'1.000',preco_over:'11,35',preco_base:'10,20',preco_reduzido:'8,60'},{item:'Crotalaria juncea â€” EspÃ©cie',kg_ha:'30',kg_sc:25,kg_bag:'1.000',preco_over:'15,20',preco_base:'14,40',preco_reduzido:'12,80'},{item:'Crotalaria breviflora â€” EspÃ©cie',kg_ha:'20',kg_sc:25,kg_bag:'1.000',preco_over:'14,30',preco_base:'13,00',preco_reduzido:'10,70'},{item:'Guandu Forrageiro â€” IPR 43 AratÃ£',kg_ha:'30',kg_sc:25,kg_bag:'1.000',preco_over:'6,60',preco_base:'5,90',preco_reduzido:'5,40'},{item:'Guandu Forrageiro â€” Fava Larga',kg_ha:'30',kg_sc:25,kg_bag:'1.000',preco_over:'6,60',preco_base:'5,90',preco_reduzido:'5,40'},{item:'TremoÃ§o Branco â€” Lupinus albus L.',kg_ha:'70',kg_sc:25,kg_bag:'1.000',preco_over:'3,20',preco_base:'2,90',preco_reduzido:'2,15'},{item:'Ervilhaca Comum â€” Ametista',kg_ha:'30',kg_sc:25,kg_bag:'1.000',preco_over:'11,45',preco_base:'10,40',preco_reduzido:'8,95'},{item:'Ervilhaca Peluda â€” SS Esmeralda',kg_ha:'30',kg_sc:25,kg_bag:'1.000',preco_over:'18,15',preco_base:'16,50',preco_reduzido:'15,30'},{item:'Ervilha Forrageira â€” IAPAR 83',kg_ha:'30',kg_sc:25,kg_bag:'1.000',preco_over:'11,80',preco_base:'10,70',preco_reduzido:'9,35'},
    
    /* DESATIVADO
        {item:'Estilosantes â€” BRS Campo Grande',kg_ha:'12',kg_sc:25,kg_bag:'1.000',preco_over:'54,95',preco_base:'50,00',preco_reduzido:'47,10'},
    */
    
    {item:'Braq. Ruziziensis â€” VC 80%',kg_ha:'6',kg_sc:20,kg_bag:'625',preco_over:'10,80',preco_base:'9,70',preco_reduzido:'8,30'},{item:'Braq. Ruziziensis â€” VC 80% + RootSafer',kg_ha:'6',kg_sc:20,kg_bag:'625',preco_over:'13,50',preco_base:'12,80',preco_reduzido:'10,80'},
    
    
    {item:'Braq. Brizantha â€” cv. BRS PiatÃ£ VC 80%',kg_ha:'10',kg_sc:25,kg_bag:'0',preco_over:'29,90',preco_base:'26,90',preco_reduzido:'24,00'},
    {item:'Braq. Brizantha â€” cv. BRS PiatÃ£-Incrustada',kg_ha:'10',kg_sc:25,kg_bag:'0',preco_over:'19,25',preco_base:'17,50',preco_reduzido:'16,50'},


    
    {item:'Milheto â€” BRS 1501',kg_ha:'15',kg_sc:25,kg_bag:'1.000',preco_over:'4,00',preco_base:'3,40',preco_reduzido:'3,10'},
                            
                            /* DESATIVADO
                            {item:'Milheto â€” ANM07',kg_ha:'15',kg_sc:25,kg_bag:'0',preco_over:'4,55',preco_base:'4,10',preco_reduzido:'3,60'},
                            */
                            
                            {item:'Capim Coracana â€” ANPG 209',kg_ha:'7',kg_sc:25,kg_bag:'1.000',preco_over:'6,05',preco_base:'5,50',preco_reduzido:'4,80'},{item:'Aveia Preta â€” Embrapa 139',kg_ha:'70',kg_sc:20,kg_bag:'700',preco_over:'5,20',preco_base:'4,70',preco_reduzido:'4,00'},{item:'Aveia Preta â€” Tropeira',kg_ha:'70',kg_sc:20,kg_bag:'700',preco_over:'5,20',preco_base:'4,70',preco_reduzido:'4,00'},{item:'Aveia Preta â€” AF1340 Ucraniana',kg_ha:'70',kg_sc:20,kg_bag:'650',preco_over:'5,20',preco_base:'4,70',preco_reduzido:'4,00'},
                            
                            {item:'Aveia Branca â€” URS Corona',kg_ha:'70',kg_sc:20,kg_bag:'650',preco_over:'4,10',preco_base:'3,65',preco_reduzido:'3,35'},
                            {item:'Aveia Branca â€” URS Taura',kg_ha:'70',kg_sc:20,kg_bag:'650',preco_over:'4,10',preco_base:'3,65',preco_reduzido:'3,35'},


    
    {item:'Centeio â€” IPR 89',kg_ha:'55',kg_sc:25,kg_bag:'1.000',preco_over:'4,75',preco_base:'4,25',preco_reduzido:'3,80'},
    
    {item:'Nabo Forrageiro â€” IPR 116',kg_ha:'15',kg_sc:25,kg_bag:'1.000',preco_over:'6,85',preco_base:'6,20',preco_reduzido:'5,30'},{item:'Nabo PÃ© de Pato â€” PÃ© de Pato',kg_ha:'12',kg_sc:25,kg_bag:'1.000',preco_over:'13,80',preco_base:'12,40',preco_reduzido:'11,40'},
    
    /* DESATIVADO
    {item:'Rabanete Forrageiro â€” Ceres Hunter',kg_ha:'4',kg_sc:25,kg_bag:'0',preco_over:'73,30',preco_base:'62,30',preco_reduzido:'60,35'},
    */

    {item:'Crambe â€” FMS Brilhante',kg_ha:'15',kg_sc:10,kg_bag:'400',preco_over:'7,80',preco_base:'6,60',preco_reduzido:'6,00'},
  
    {item:'Trigo Mourisco â€” IPR 91 Baili',kg_ha:'50',kg_sc:15,kg_bag:'750',preco_over:'5,85',preco_base:'5,30',preco_reduzido:'4,70'},
    {item:'Trigo Mourisco â€” IPR 92 Altar',kg_ha:'50',kg_sc:15,kg_bag:'750',preco_over:'5,85',preco_base:'5,30',preco_reduzido:'4,70'}
  
  
  ];

    window.DATA_DISTRIBUICAO=[{item:'SORGO ADV1151 IG SC',kg_ha:'-',kg_sc:'-',kg_bag:'-',preco_over:'',preco_base:'690',preco_reduzido:''},{item:'AG MIX CORINGAÂ® â€” MIX',kg_ha:'30',kg_sc:25,kg_bag:'900',preco_over:'7,70',preco_base:'6,90',preco_reduzido:'5,90'},{item:'AG MIX NEMATOIDEÂ® â€” MIX',kg_ha:'20',kg_sc:25,kg_bag:'900',preco_over:'11,15',preco_base:'10,00',preco_reduzido:'7,95'},{item:'AG MIX CANAÂ® â€” MIX',kg_ha:'30',kg_sc:20,kg_bag:'800',preco_over:'10,70',preco_base:'9,60',preco_reduzido:'7,70'},{item:'AG MIX CAFÃ‰Â® â€” MIX',kg_ha:'30',kg_sc:25,kg_bag:'900',preco_over:'8,85',preco_base:'7,95',preco_reduzido:'6,45'},{item:'AG MIX INVERNOÂ® â€” MIX',kg_ha:'50',kg_sc:20,kg_bag:'800',preco_over:'6,55',preco_base:'5,80',preco_reduzido:'4,75'},{item:'AG MIX PASTEJOÂ® â€” MIX',kg_ha:'25',kg_sc:25,kg_bag:'900',preco_over:'7,80',preco_base:'7,00',preco_reduzido:'5,40'},{item:'AG MIX PRECOCEÂ® â€” MIX',kg_ha:'25',kg_sc:20,kg_bag:'800',preco_over:'6,95',preco_base:'6,25',preco_reduzido:'5,00'},{item:'AG MIX PALHADAÂ® â€” MIX',kg_ha:'25',kg_sc:25,kg_bag:'900',preco_over:'10,25',preco_base:'9,20',preco_reduzido:'7,70'},{item:'AG MIX PACK 01 â€” MIX',kg_ha:'25',kg_sc:20,kg_bag:'900',preco_over:'4,65',preco_base:'4,15',preco_reduzido:'3,80'},{item:'AG MIX PACK 02 â€” MIX',kg_ha:'15',kg_sc:25,kg_bag:'1.000',preco_over:'8,55',preco_base:'7,60',preco_reduzido:'6,20'},{item:'AG MIX PACK 03 â€” MIX',kg_ha:'15',kg_sc:25,kg_bag:'1.000',preco_over:'8,70',preco_base:'7,80',preco_reduzido:'6,75'},
    {item:'LINHA BUDGET - AG MIX 01',kg_ha:'10',kg_sc:20,kg_bag:'700',preco_over:'9,80',preco_base:'8,30',preco_reduzido:'7,00'},{item:'LINHA BUDGET - AG MIX 02',kg_ha:'10',kg_sc:20,kg_bag:'700',preco_over:'7,50',preco_base:'6,40',preco_reduzido:'5,60'},{item:'LINHA BUDGET - AG MIX 03',kg_ha:'20',kg_sc:25,kg_bag:'800',preco_over:'8,10',preco_base:'6,90',preco_reduzido:'5,40'},{item:'LINHA BUDGET - AG MIX 04',kg_ha:'16',kg_sc:25,kg_bag:'800',preco_over:'7,40',preco_base:'6,30',preco_reduzido:'5,10'},{item:'LINHA BUDGET - AG MIX 05',kg_ha:'20',kg_sc:20,kg_bag:'800',preco_over:'6,20',preco_base:'5,30',preco_reduzido:'4,70'},{item:'LINHA BUDGET - AG MIX 06',kg_ha:'21',kg_sc:25,kg_bag:'1.000',preco_over:'5,50',preco_base:'4,70',preco_reduzido:'4,00'},{item:'LINHA BUDGET - AG MIX 07',kg_ha:'13',kg_sc:25,kg_bag:'1.000',preco_over:'5,10',preco_base:'4,30',preco_reduzido:'3,60'},{item:'LINHA BUDGET - AG MIX 08',kg_ha:'15',kg_sc:25,kg_bag:'1.000',preco_over:'8,00',preco_base:'6,80',preco_reduzido:'5,70'},{item:'LINHA BUDGET - AG MIX 09',kg_ha:'15',kg_sc:25,kg_bag:'1.000',preco_over:'9,40',preco_base:'8,00',preco_reduzido:'6,70'},{item:'LINHA BUDGET - AG MIX 10',kg_ha:'27',kg_sc:20,kg_bag:'700',preco_over:'4,30',preco_base:'3,80',preco_reduzido:'3,40'},{item:'LINHA BUDGET - AG MIX 11',kg_ha:'32',kg_sc:20,kg_bag:'700',preco_over:'4,60',preco_base:'3,90',preco_reduzido:'3,40'},{item:'LINHA BUDGET - AG MIX 12',kg_ha:'30',kg_sc:15,kg_bag:'600',preco_over:'5,20',preco_base:'4,40',preco_reduzido:'3,80'},
    {item:'Crotalaria ochroleuca â€” EspÃ©cie',kg_ha:'15',kg_sc:25,kg_bag:'1.000',preco_over:'7,90',preco_base:'7,10',preco_reduzido:'6,40'},{item:'Crotalaria spectabilis â€” EspÃ©cie',kg_ha:'20',kg_sc:25,kg_bag:'1.000',preco_over:'10,15',preco_base:'9,10',preco_reduzido:'7,70'},{item:'Crotalaria juncea â€” EspÃ©cie',kg_ha:'30',kg_sc:25,kg_bag:'1.000',preco_over:'14,30',preco_base:'12,85',preco_reduzido:'11,60'},{item:'Crotalaria breviflora â€” EspÃ©cie',kg_ha:'20',kg_sc:25,kg_bag:'1.000',preco_over:'12,95',preco_base:'11,65',preco_reduzido:'8,55'},{item:'Guandu Forrageiro â€” IPR 43 AratÃ£',kg_ha:'30',kg_sc:25,kg_bag:'1.000',preco_over:'6,25',preco_base:'5,60',preco_reduzido:'4,70'},{item:'Guandu Forrageiro â€” Fava Larga',kg_ha:'30',kg_sc:25,kg_bag:'1.000',preco_over:'6,25',preco_base:'5,60',preco_reduzido:'4,70'},{item:'TremoÃ§o Branco â€” Lupinus albus L.',kg_ha:'70',kg_sc:25,kg_bag:'1.000',preco_over:'2,85',preco_base:'2,55',preco_reduzido:'1,90'},{item:'Ervilhaca Comum â€” Ametista',kg_ha:'30',kg_sc:25,kg_bag:'1.000',preco_over:'10,40',preco_base:'9,35',preco_reduzido:'8,50'},{item:'Ervilhaca Peluda â€” SS Esmeralda',kg_ha:'30',kg_sc:25,kg_bag:'1.000',preco_over:'22,15',preco_base:'19,90',preco_reduzido:'18,55'},{item:'Ervilha Forrageira â€” IAPAR 83',kg_ha:'30',kg_sc:25,kg_bag:'1.000',preco_over:'11,35',preco_base:'10,20',preco_reduzido:'8,00'},
    
    /* DESATIVADO
    {item:'Estilosantes â€” BRS Campo Grande',kg_ha:'12',kg_sc:25,kg_bag:'1.000',preco_over:'49,50',preco_base:'44,55',preco_reduzido:'41,75'},
    */
    
    {item:'Braq. Ruziziensis â€” VC 80%',kg_ha:'6',kg_sc:20,kg_bag:'625',preco_over:'10,00',preco_base:'9,00',preco_reduzido:'8,35'},{item:'Braq. Ruziziensis â€” VC 80% + RootSafer',kg_ha:'6',kg_sc:20,kg_bag:'625',preco_over:'12,30',preco_base:'11,05',preco_reduzido:'10,00'},
    
    
    {item:'Braq. Brizantha â€” cv. BRS PiatÃ£ VC 80%',kg_ha:'10',kg_sc:20,kg_bag:'700',preco_over:'26,40',preco_base:'23,75',preco_reduzido:'22,40'},
    {item:'Braq. Brizantha â€” cv. BRS PiatÃ£-Incrustada',kg_ha:'10',kg_sc:25,kg_bag:'0',preco_over:'17,35',preco_base:'15,75',preco_reduzido:'14,85'},
    
    
    {item:'Milheto â€” BRS 1501',kg_ha:'15',kg_sc:25,kg_bag:'1.000',preco_over:'2,75',preco_base:'2,45',preco_reduzido:'2,30'},
                              
                              /* DESATIVADO
                              {item:'Milheto â€” ANM07',kg_ha:'15',kg_sc:25,kg_bag:'0',preco_over:'4,30',preco_base:'3,85',preco_reduzido:'3,30'},
                              */
                              
                              {item:'Capim Coracana â€” ANPG 209',kg_ha:'7',kg_sc:25,kg_bag:'1.000',preco_over:'5,45',preco_base:'4,90',preco_reduzido:'4,25'},{item:'Aveia Preta â€” Embrapa 139',kg_ha:'70',kg_sc:20,kg_bag:'700',preco_over:'4,30',preco_base:'3,85',preco_reduzido:'3,45'},{item:'Aveia Preta â€” Tropeira',kg_ha:'70',kg_sc:20,kg_bag:'700',preco_over:'4,30',preco_base:'3,85',preco_reduzido:'3,45'},{item:'Aveia Preta â€” AF1340 Ucraniana',kg_ha:'70',kg_sc:20,kg_bag:'650',preco_over:'4,30',preco_base:'3,85',preco_reduzido:'3,45'},
                              
                              {item:'Aveia Branca â€” URS Corona',kg_ha:'70',kg_sc:20,kg_bag:'650',preco_over:'3,85',preco_base:'3,50',preco_reduzido:'3,45'},
                              {item:'Aveia Branca â€” URS Taura',kg_ha:'70',kg_sc:20,kg_bag:'650',preco_over:'3,85',preco_base:'3,50',preco_reduzido:'3,45'},
    
    
    {item:'Centeio â€” IPR 89',kg_ha:'55',kg_sc:25,kg_bag:'1.000',preco_over:'3,75',preco_base:'3,40',preco_reduzido:'2,90'},
    
    
    {item:'Nabo Forrageiro â€” IPR 116',kg_ha:'15',kg_sc:25,kg_bag:'1.000',preco_over:'5,35',preco_base:'4,80',preco_reduzido:'4,45'},{item:'Nabo PÃ© de Pato â€” PÃ© de Pato',kg_ha:'12',kg_sc:25,kg_bag:'1.000',preco_over:'12,60',preco_base:'11,30',preco_reduzido:'10,35'},
    
    /* DESATIVADO
    {item:'Rabanete Forrageiro â€” Ceres Hunter',kg_ha:'4',kg_sc:25,kg_bag:'0',preco_over:'80,00',preco_base:'72,00',preco_reduzido:'63,75'},
    */
    
    {item:'Crambe â€” FMS Brilhante',kg_ha:'15',kg_sc:10,kg_bag:'400',preco_over:'5,60',preco_base:'5,00',preco_reduzido:'4,50'},{item:'Trigo Mourisco â€” IPR 91 Baili',kg_ha:'50',kg_sc:25,kg_bag:'1.000',preco_over:'5,00',preco_base:'4,50',preco_reduzido:'4,00'},{item:'Trigo Mourisco â€” IPR 92 Altar',kg_ha:'50',kg_sc:25,kg_bag:'1.000',preco_over:'5,00',preco_base:'4,50',preco_reduzido:'4,00'}];

    window.SPECIALS_CONSUMIDOR=[{item:'ROOTSAFER',descricao:'0,25â€“0,35 L/ha Â· valor por litro do produto',preco:'185,00'},{item:'BIORECOVER',descricao:'Bacillus + T. asperellum Â· valor por kg de semente tratada (1,25/kg TS)',preco:'1,25'}];
    window.SPECIALS_DISTRIBUICAO=[{item:'ROOTSAFER',descricao:'0,25â€“0,35 L/ha Â· valor por litro do produto',preco:'127,50'},{item:'BIORECOVER',descricao:'Bacillus + T. asperellum Â· valor por kg de semente tratada',preco:'1,15'}];
  </script>

  <script type="module">
    // =========================
    // Firebase Auth (Email/Senha) - SEM cadastro
    // =========================
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      signInWithEmailAndPassword,
      signOut,
      sendPasswordResetEmail,
      setPersistence,
      browserLocalPersistence
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

    // --- SUA CONFIG (mantida) ---
    const firebaseConfig = {
      apiKey: "AIzaSyARpM8n6c12Al6YgPxD_GOuAmLs6U2y4us",
      authDomain: "ag-croppers.firebaseapp.com",
      projectId: "ag-croppers",
      storageBucket: "ag-croppers.firebasestorage.app",
      messagingSenderId: "1009802908012",
      appId: "1:1009802908012:web:c1ff8ec5ff65d16e4b2349",
      measurementId: "G-JC9RK9KYTY"
    };

    const fbApp = initializeApp(firebaseConfig);
    const auth = getAuth(fbApp);

    // PersistÃªncia: mantÃ©m logado neste navegador
    await setPersistence(auth, browserLocalPersistence);

    // ======== APP (seu cÃ³digo, com gate de autenticaÃ§Ã£o) ========
    function readJsonScript(id, fallback){
      const el = document.getElementById(id);
      if (!el) return fallback;
      try{
        const raw = (el.textContent || '').trim();
        if (!raw) return fallback;
        return JSON.parse(raw);
      }catch(e){
        console.warn(`[Lista de PreÃ§os] JSON invÃ¡lido em #${id}`, e);
        return fallback;
      }
    }

    // Datasets principais
    const dataConsumidor = (window.DATA_CONSUMIDOR ?? readJsonScript('data-consumidor', []));
    const dataDistribuicao = (window.DATA_DISTRIBUICAO ?? readJsonScript('data-distribuicao', []));

    // Itens especiais
    const specialsConsumidor = (window.SPECIALS_CONSUMIDOR ?? readJsonScript('spec-consumidor', []));
    const specialsDistribuicao = (window.SPECIALS_DISTRIBUICAO ?? readJsonScript('spec-distribuicao', []));

    // ======== Estado / PersistÃªncia ========
    const STORAGE_KEY = 'ag_prices_list_type_v1';

    /** @type {'consumidor'|'distribuicao'|null} */
    let selected = null;

    const state = {
      term: '',
      priceTier: 'base', // 'over' | 'base' | 'reduzido'
    };

    // ======== Helpers ========
    const fmtBRL = (v) => {
      if (v === null || v === undefined || v === '') return 'â€”';
      return `R$ ${v}`;
    };

    const normalize = (s) => (s || '')
      .toString()
      .normalize('NFD')
      .replace(/\p{Diacritic}/gu,'')
      .toLowerCase();

    function escapeHtml(str){
      return (str ?? '').toString()
        .replace(/&/g,'&amp;')
        .replace(/</g,'&lt;')
        .replace(/>/g,'&gt;')
        .replace(/"/g,'&quot;')
        .replace(/'/g,'&#039;');
    }

    function asArray(x){
      return Array.isArray(x) ? x : [];
    }

    // âœ… LÃ“GICA DE CORES DOS PRODUTOS
    const getProductType = (name) => {
      const n = normalize(name).toUpperCase();

      // 0. BUDGET (Priority Check - Roxo)
      if (n.includes('LINHA BUDGET')) return 'type-budget';
      
      // 1. MIX (Verde)
      if (n.includes('AG MIX')) return 'type-green';
      
      // 2. LEGUMINOSAS (Laranja/SalmÃ£o)
      // CrotalÃ¡ria, Guandu, TremoÃ§o, Ervilha, Ervilhaca, Estilosantes
      if (n.includes('CROTALARIA') || n.includes('GUANDU') || n.includes('TREMOCO') || 
          n.includes('ERVILHA') || n.includes('ESTILOSANTES')) return 'type-orange';

      // 3. GRAMINEAS (Azul/Roxo)
      // BraquiÃ¡ria, Milheto, Capim, Aveia, Centeio, Coracana
      if (n.includes('BRAQ') || n.includes('MILHETO') || n.includes('CAPIM') || 
          n.includes('AVEIA') || n.includes('CENTEIO') || n.includes('CORACANA')) return 'type-blue';

      // 4. OUTROS (Cinza)
      // Nabo, Rabanete, Crambe, Trigo (e o que sobrar)
      return 'type-gray';
    };

    const getDataset = () => {
      if (selected === 'consumidor') {
        return { rows: asArray(dataConsumidor), specials: asArray(specialsConsumidor), label: 'Lista Consumidor (Venda Direta)', dot: 'green' };
      }
      if (selected === 'distribuicao') {
        return { rows: asArray(dataDistribuicao), specials: asArray(specialsDistribuicao), label: 'Lista DistribuiÃ§Ã£o (Distribuidor)', dot: 'blue' };
      }
      return null;
    };

    const filterRows = (rows) => {
      const safe = asArray(rows);
      const t = normalize(state.term);
      if (!t) return safe;
      return safe.filter(r => normalize(r?.item).includes(t));
    };

    const getPrice = (row) => {
      if (state.priceTier === 'over') return row?.preco_over;
      if (state.priceTier === 'reduzido') return row?.preco_reduzido;
      return row?.preco_base;
    };

    // ======== UI ========
    const app = document.getElementById('app');

    const iconUser = () => `
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4Z" fill="white" opacity=".95"/>
        <path d="M4 20c1.6-4 14.4-4 16 0" stroke="white" stroke-width="2" stroke-linecap="round"/>
      </svg>
    `;

    const iconTruck = () => `
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M3 7h11v10H3V7Z" stroke="white" stroke-width="2"/>
        <path d="M14 10h4l3 3v4h-7v-7Z" stroke="white" stroke-width="2"/>
        <path d="M7 19a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z" fill="white"/>
        <path d="M18 19a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z" fill="white"/>
      </svg>
    `;

    const iconSearch = () => `
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="2"/>
        <path d="M16.5 16.5 21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    `;

    const iconMail = () => `
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M4 7h16v10H4V7Z" stroke="currentColor" stroke-width="2"/>
        <path d="m4 8 8 6 8-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    `;

    const iconLock = () => `
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M7 11V8a5 5 0 0 1 10 0v3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M6 11h12v10H6V11Z" stroke="currentColor" stroke-width="2"/>
      </svg>
    `;

    function showAuthError(msg){
      const el = document.getElementById('authError');
      if (!el) return;
      el.textContent = msg || 'Falha ao autenticar.';
      el.style.display = 'block';
    }

    function clearAuthError(){
      const el = document.getElementById('authError');
      if (!el) return;
      el.textContent = '';
      el.style.display = 'none';
    }

    const renderLogin = () => {
      app.innerHTML = `
        
        <section class="authWrap">
          <div class="authCard">
            <div class="authBody">
              <div class="authLogo">
                <img src="https://cdn.jsdelivr.net/gh/agcroppers/lista-precos-oficial/assets/Logo%20Verde%20Liso%20AGC.png" alt="AG Croppers" />
              </div>

              <h2 class="authTitle">Bem-vindo</h2>
              <p class="authSub">FaÃ§a login para acessar a Lista de PreÃ§os Oficiais.</p>

              <div class="authGrid">
                <div class="authField">
                  ${iconMail()}
                  <input id="loginEmail" type="email" autocomplete="username" placeholder="E-mail" />
                </div>
                <div class="authField">
                  ${iconLock()}
                  <input id="loginPass" type="password" autocomplete="current-password" placeholder="Senha" />
                </div>
              </div>

              <div class="authActions">
                <button class="authBtn" id="btnLogin" type="button">Entrar</button>
              </div>

              <div class="authLinks">
                <a href="#" id="lnkReset">Esqueci minha senha</a>
              </div>

              <div class="authError" id="authError"></div>

              <div class="authNote">Apenas para uso interno. Proibido o reenvio ou compartilhamento.</div>
            </div>
          </div>
        </section>
      `;

      const emailEl = document.getElementById('loginEmail');
      const passEl  = document.getElementById('loginPass');
      const btn     = document.getElementById('btnLogin');
      const reset   = document.getElementById('lnkReset');

      const doLogin = async () => {
        clearAuthError();
        const email = (emailEl?.value || '').trim();
        const pass  = (passEl?.value || '').trim();

        if (!email || !pass){
          showAuthError('Informe e-mail e senha.');
          return;
        }

        btn.disabled = true;
        btn.textContent = 'Entrando...';

        try{
          await signInWithEmailAndPassword(auth, email, pass);
          // onAuthStateChanged vai renderizar o app
        }catch(err){
          const code = err?.code || '';
          if (code.includes('auth/invalid-credential') || code.includes('auth/wrong-password') || code.includes('auth/user-not-found')){
            showAuthError('E-mail ou senha invÃ¡lidos.');
          }else if (code.includes('auth/too-many-requests')){
            showAuthError('Muitas tentativas. Tente novamente em alguns minutos.');
          }else{
            showAuthError('Falha ao autenticar. Verifique e tente novamente.');
          }
        }finally{
          btn.disabled = false;
          btn.textContent = 'Entrar';
        }
      };

      btn?.addEventListener('click', doLogin);
      passEl?.addEventListener('keydown', (e) => { if (e.key === 'Enter') doLogin(); });
      emailEl?.addEventListener('keydown', (e) => { if (e.key === 'Enter') doLogin(); });

      reset?.addEventListener('click', async (e) => {
        e.preventDefault();
        clearAuthError();
        const email = (emailEl?.value || '').trim();
        if (!email){
          showAuthError('Digite seu e-mail para receber o link de redefiniÃ§Ã£o.');
          return;
        }
        try{
          await sendPasswordResetEmail(auth, email);
          showAuthError('Link de redefiniÃ§Ã£o enviado. Verifique seu e-mail.');
        }catch(err){
          showAuthError('NÃ£o foi possÃ­vel enviar o link. Verifique o e-mail informado.');
        }
      });
    };

    const renderChooser = () => {
      app.innerHTML = `
        <section class="chooser">
          <div class="chooserCard">
            <div class="chooserTop">
              <h2>Escolha qual lista vocÃª quer visualizar</h2>
              <p>VocÃª pode alternar a qualquer momento. A escolha fica salva neste dispositivo.</p>
            </div>
            <div class="chooserGrid">
              <button class="chooseBtn" onclick="window.__selectList('consumidor')">
                <div class="chooseTitle">
                  <span class="bigIcon iGreen">${iconUser()}</span>
                  Lista Consumidor / Venda Direta
                </div>
                <div class="chooseDesc">Ideal para consulta rÃ¡pida com o cliente. Mostra preÃ§os e parÃ¢metros do produto de forma limpa e responsiva.</div>
              </button>

              <button class="chooseBtn" onclick="window.__selectList('distribuicao')">
                <div class="chooseTitle">
                  <span class="bigIcon iBlue">${iconTruck()}</span>
                  Lista DistribuiÃ§Ã£o / Distribuidor
                </div>
                <div class="chooseDesc">Para negociaÃ§Ãµes com canal e parceiros. Mesma experiÃªncia premium, com dados da tabela de distribuiÃ§Ã£o.</div>
              </button>
            </div>
          </div>
        </section>
      `;
    };

        // ======== Busca (suave) ========
    let __searchDebounceTimer = null;
    let __searchIsComposing = false;
    let __searchPending = '';
    let __searchCaret = null;

    function __scheduleSearchRender(value, caret){
      __searchPending = value ?? '';
      __searchCaret = (typeof caret === 'number') ? caret : null;

      if (__searchDebounceTimer) clearTimeout(__searchDebounceTimer);
      __searchDebounceTimer = setTimeout(() => {
        // evita re-render desnecessÃ¡rio
        if (state.term === __searchPending) return;
        state.term = __searchPending;
        renderApp();

        // restaura foco/cursor para nÃ£o "piscar" enquanto digita
        try{
          const s = document.getElementById('search');
          if (s){
            s.focus({ preventScroll: true });
            const pos = (__searchCaret ?? s.value.length);
            s.setSelectionRange(pos, pos);
          }
        }catch(e){}
      }, 120);
    }

const renderApp = () => {
      const ds = getDataset();
      if (!ds) return renderChooser();

      const filtered = filterRows(ds.rows) || [];
      const safeFiltered = asArray(filtered);
      const count = safeFiltered.length;

      const dot = ds.dot === 'green'
        ? '<span class="pillDot" style="background:#2e8b57; box-shadow:0 0 0 3px rgba(46,139,87,.12)"></span>'
        : '<span class="pillDot" style="background:#2b74c7; box-shadow:0 0 0 3px rgba(43,116,199,.12)"></span>';

      const userEmail = (auth.currentUser?.email || '').trim();

      app.innerHTML = `
        <header class="topbar">
          <div style="display:flex; align-items:center; gap:12px;">
             <img src="https://cdn.jsdelivr.net/gh/agcroppers/lista-precos-oficial/assets/Logo%20Verde%20Liso%20AGC.png" alt="Logo AGC" style="height:44px; width:auto; display:block;">
             <div class="titleWrap">
               <h1>Lista de PreÃ§os Oficiais</h1>
               <div class="subtitle">APENAS PARA USO INTERNO. PROIBIDO O REENVIO OU COMPARTILHAMENTO</div>
             </div>
          </div>

          <div class="controls">
            <div class="segmented" role="group" aria-label="Selecionar lista">
              <button type="button" aria-pressed="${selected==='consumidor'}" onclick="window.__selectList('consumidor')">
                ${dot.replace('#2b74c7','#2e8b57')} Consumidor
              </button>
              <button type="button" aria-pressed="${selected==='distribuicao'}" onclick="window.__selectList('distribuicao')">
                ${dot.replace('#2e8b57','#2b74c7')} DistribuiÃ§Ã£o
              </button>
            </div>

            <div class="search">
              ${iconSearch()}
              <input id="search" value="${escapeHtml(state.term)}" placeholder="Buscar produto (ex.: crotalaria, aveia, nematoide...)" />
            </div>
          </div>
        </header>

        <section class="shell">
          <div class="metaRow">
            <div class="badge">${dot} <strong>${ds.label}</strong></div>

            <div class="rightMeta">
              <div class="chip"><span class="muted">Itens:</span> <strong class="mono">${count}</strong></div>

              <div class="chip">
                <span class="muted">PreÃ§o:</span>
                <select id="tier" aria-label="Selecionar tipo de preÃ§o">
                  <option value="base" ${state.priceTier==='base'?'selected':''}>Base</option>
                  <option value="over" ${state.priceTier==='over'?'selected':''}>Over</option>
                  <option value="reduzido" ${state.priceTier==='reduzido'?'selected':''}>Reduzido</option>
                </select>
              </div>

              <button class="chip chipBtn" type="button" onclick="window.__resetChoice()" title="Trocar na primeira tela">Trocar lista</button>

              ${userEmail ? `<div class="chip"><span class="muted">Logado:</span> <strong class="mono">${escapeHtml(userEmail)}</strong></div>` : ``}
              <button class="chip chipBtn" type="button" onclick="window.__logout()" title="Sair">Sair</button>
            </div>
          </div>

          <div class="tableWrap" aria-label="Tabela de preÃ§os">
            <table>
              <thead>
                <tr>
                  <th class="col-item">Produto / Cultivar</th>
                  <th>KG-L/HA</th>
                  <th>KG/SC</th>
                  <th>KG/BAG</th>
                  <th>PreÃ§o (selecionado)</th>
                  <th class="muted">Over</th>
                  <th class="muted">Base</th>
                  <th class="muted">Reduzido</th>
                </tr>
              </thead>
              <tbody>
                ${safeFiltered.map(r => {
                  // 1. Descobre a cor baseado no nome original
                  const originalName = r?.item || '';
                  const typeClass = getProductType(originalName);
                  
                  // 2. Se for BUDGET, adiciona a tag
                  const isBudget = typeClass === 'type-budget';
                  const tagHtml = isBudget ? '<span class="tag-budget">BUDGET</span>' : '';

                  // 3. Se for BUDGET, remove o prefixo "LINHA BUDGET" do texto exibido
                  let displayName = originalName;
                  if (isBudget) {
                     displayName = displayName.replace(/LINHA BUDGET\s*[-â€“â€”]?\s*/i, '').trim();
                  }
                  
                  return `
                    <tr>
                      <td class="${typeClass}"><strong>${tagHtml}${escapeHtml(displayName)}</strong></td>
                      <td class="mono">${escapeHtml(r?.kg_ha || 'â€”')}</td>
                      <td class="mono">${r?.kg_sc ?? 'â€”'}</td>
                      <td class="mono">${r?.kg_bag ?? 'â€”'}</td>
                      <td class="price">${fmtBRL(getPrice(r))}</td>
                      <td class="mono muted">${fmtBRL(r?.preco_over)}</td>
                      <td class="mono muted">${fmtBRL(r?.preco_base)}</td>
                      <td class="mono muted">${fmtBRL(r?.preco_reduzido)}</td>
                    </tr>
                  `;
                }).join('')}
              </tbody>
            </table>
          </div>

          <div class="cards" aria-label="Cards de preÃ§os">
            <div class="cardGrid">
              ${safeFiltered.map(r => {
                 const originalName = r?.item || '';
                 const typeClass = getProductType(originalName);
                 
                 // Mapeia classe do td para classe do card
                 let cardClass = '';
                 if (typeClass.includes('green')) cardClass = 'card-green';
                 else if (typeClass.includes('orange')) cardClass = 'card-orange';
                 else if (typeClass.includes('blue')) cardClass = 'card-blue';
                 else if (typeClass.includes('budget')) cardClass = 'card-budget';
                 else cardClass = 'card-gray';
                 
                 // Tag para mobile (opcional, mas bom pra consistÃªncia)
                 const isBudget = typeClass === 'type-budget';
                 const tagHtml = isBudget ? '<span class="tag-budget" style="margin-bottom:4px; display:inline-block">BUDGET</span><br>' : '';

                 // Ajuste do nome tambÃ©m no mobile
                 let displayName = originalName;
                 if (isBudget) {
                     displayName = displayName.replace(/LINHA BUDGET\s*[-â€“â€”]?\s*/i, '').trim();
                 }
                 
                 return `
                  <div class="pCard ${cardClass}">
                    <div class="pHead">
                      <div>
                        <div class="pTitle">${tagHtml}${escapeHtml(displayName)}</div>
                        <div class="pMeta">
                          KG-L/HA: <span class="mono">${escapeHtml(r?.kg_ha || 'â€”')}</span> Â·
                          KG/SC: <span class="mono">${r?.kg_sc ?? 'â€”'}</span> Â·
                          KG/BAG: <span class="mono">${r?.kg_bag ?? 'â€”'}</span>
                        </div>
                      </div>
                      <div class="price" style="text-align:right">
                        ${fmtBRL(getPrice(r))}
                        <div class="muted" style="font-size:11px; font-weight:500; margin-top:4px">preÃ§o selecionado</div>
                      </div>
                    </div>

                    <div class="pPrices">
                      <div class="pBox bx-over"><div class="pLabel">Over</div><div class="pVal">${fmtBRL(r?.preco_over)}</div></div>
                      <div class="pBox bx-base"><div class="pLabel">Base</div><div class="pVal">${fmtBRL(r?.preco_base)}</div></div>
                      <div class="pBox bx-red"><div class="pLabel">Reduzido</div><div class="pVal">${fmtBRL(r?.preco_reduzido)}</div></div>
                    </div>
                  </div>
                `;
              }).join('')}
            </div>
          </div>

          <div class="specials" aria-label="Itens especiais">
            ${asArray(ds.specials).map(s => `
              <div class="special">
                <div>
                  <div class="name">${escapeHtml(s?.item ?? '')}</div>
                  <div class="desc">${escapeHtml(s?.descricao ?? '')}</div>
                </div>
                <div class="p">${fmtBRL(s?.preco)}</div>
              </div>
            `).join('')}
          </div>
        </section>
      `;

      // bind
      const search = document.getElementById('search');
      const tier = document.getElementById('tier');

      if (search){
        search.addEventListener('compositionstart', () => { __searchIsComposing = true; });
        search.addEventListener('compositionend', (e) => {
          __searchIsComposing = false;
          const el = e.target;
          __scheduleSearchRender(el.value, el.selectionStart);
        });

        search.addEventListener('input', (e) => {
          if (__searchIsComposing) return;
          const el = e.target;
          __scheduleSearchRender(el.value, el.selectionStart);
        });
      }
if (tier){
        tier.addEventListener('change', (e) => {
          state.priceTier = e.target.value;
          renderApp();
        });
      }
    };

    // ======== Public API p/ botÃµes inline ========
    window.__selectList = (type) => {
      selected = type;
      try{ localStorage.setItem(STORAGE_KEY, type); }catch(e){}
      renderApp();
    };

    window.__resetChoice = () => {
      selected = null;
      try{ localStorage.removeItem(STORAGE_KEY); }catch(e){}
      renderChooser();
    };

    window.__logout = async () => {
      try{ await signOut(auth); }catch(e){}
      // onAuthStateChanged vai renderizar login
    };

    // ======== â€œTestesâ€ simples (nÃ£o quebram a UI) ========
    (function devTests(){
      const t1 = asArray(null);
      console.assert(Array.isArray(t1) && t1.length === 0, 'asArray(null) deve retornar []');
      const t2 = filterRows(null);
      console.assert(Array.isArray(t2), 'filterRows(null) deve retornar array');
      const t3 = filterRows([{item:'Aveia'}]);
      console.assert(Array.isArray(t3) && t3.length === 1, 'filterRows(array) deve preservar itens quando busca vazia');
    })();

    function initAfterLogin(){
      try{
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved === 'consumidor' || saved === 'distribuicao') selected = saved;
      }catch(e){}

      if (!selected) renderChooser();
      else renderApp();
    }

    // ======== Gate de autenticaÃ§Ã£o ========
    onAuthStateChanged(auth, (user) => {
      if (!user){
        selected = null; // opcional: forÃ§a o chooser apÃ³s login
        renderLogin();
        return;
      }
      initAfterLogin();
    });
  </script>
</body>
</html>
